version: "3.8"
services:
  postgres:
    image: postgres:15
    container_name: itnvend-postgres-dev
    env_file:
      - ./.env
    volumes:
      - ./pgdata:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  pgadmin:
    image: dpage/pgadmin4
    container_name: itnvend-pgadmin-dev
    env_file:
      - ./.env
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL:-admin@local.com}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD:-x8Yk9rV3mTq2Pz7Hs4Nw6LbC}
    ports:
      - "8080:80"
    depends_on:
      - postgres
    volumes:
      - ./pgadmin:/var/lib/pgadmin

  server:
    image: node:18
    container_name: itnvend-server-dev
    working_dir: /workspace/server
    command: ["sh", "-c", "npm install --no-audit --no-fund && npm run start"]
    volumes:
      - ../:/workspace:delegated
      - ./server/public/Images:/workspace/server/public/Images
      - node_modules:/workspace/server/node_modules
    ports:
      - "4000:4000"
    env_file:
      - ./.env
    environment:
      NODE_ENV: development
    depends_on:
      - postgres

volumes:
  node_modules: {}
